function initSkill(e){for(var o={},l=0;l<e.size();l++)o[e[l].n]=0;return o}function enable(e){var o=!0;return vm.selected.forEach(function(l){e.n==l.n&&(o=!1)}),""!=vm.condition&&e.n.indexOf(vm.condition)<0&&(o=!1),o}avalon.config({baseUrl:"lib",debug:!1});var armor=[[[],[],[],[],[]],[[],[],[],[],[]]],gem=[],skillEffect={},skill=[],holeValue=[0,14,32,61],vm=avalon.define({$id:"mho",popup:"",closable:!0,skill:[],selected:[],armor:[],gem:[],own:[],info:"",condition:"",$computed:{ranged:{set:function(e){localStorage.setItem("ranged",e)},get:function(){return localStorage.getItem("ranged")?eval(localStorage.getItem("ranged")):!1}}},hidePopup:function(e){vm.closable&&"div"==e.target.nodeName.toLowerCase()&&(vm.popup="")},listSkill:function(){vm.skill=skill.filter(enable),vm.closable=!0,vm.popup="skill_choose"},addSkill:function(e,o,l){vm.selected.push({n:e,v:o,r:10,hv:[0,0,0,0]}),vm.condition="",vm.popup=""},skillMinus:function(e){e.r--},skillPlus:function(e){e.r++},skillJoin:function(e){var o=[];for(var l in e)o.push(l+e[l]);return o.join("，")},showChosen:function(e){e.o=!e.o},calc:function(){var e=initSkill(vm.selected),o=vm.ranged?1:0,l={};vm.gem=[],holeValue=[0,0,0,0];for(var r=1;3>=r;r++)for(var n=0;n<vm.selected.size();n++){var m=vm.selected[n].n;for(var t in gem)m in gem[t].s&&gem[t].s[m]>0&&gem[t].h==r&&(vm.selected[n].hv[r]=gem[t].s[m]*vm.selected[n].v)}for(var r=1;3>=r;r++){for(var n=0;n<vm.selected.size();n++){var m=vm.selected[n].n;0==vm.selected[n].hv[r]&&(vm.selected[n].hv[r]=1==r?vm.selected[n].hv[2]/2:vm.selected[n].hv[1]+vm.selected[n].hv[r-1]),holeValue[r]+=vm.selected[n].hv[r]}holeValue[r]=holeValue[r]/vm.selected.size()}do{l=initSkill(vm.selected),vm.armor=[];for(var t=0;5>t;t++){var a=0,s=-1;for(var i in armor[o][t]){for(var v=holeValue[armor[o][t][i].h],n=0;n<vm.selected.size();n++){var m=vm.selected[n].n;m in armor[o][t][i].s&&(v+=vm.selected[n].v*armor[o][t][i].s[m]*vm.selected[n].r/(vm.selected[n].r+1.5*e[m]))}v>a&&(a=v,s=i)}a>0&&vm.armor.push(armor[o][t][s])}for(var c=0,f=0,n=0;n<vm.selected.size();n++){for(var m=vm.selected[n].n,t=0;t<vm.armor.size();t++)m in vm.armor[t].s&&(l[m]+=vm.armor[t].s[m]);l[m]>vm.selected[n].r+e[m]?(e[m]++,c++):l[m]<vm.selected[n].r&&f++}}while(c>0&&f>0);var d=0;l=initSkill(vm.selected),vm.own=[];for(var t=0;t<vm.armor.size();t++){vm.armor[t].h>d&&(d=vm.armor[t].h);for(var n in vm.armor[t].s)n in l?l[n]+=vm.armor[t].s[n]:l[n]=vm.armor[t].s[n]}Object.keys(l).forEach(function(e){vm.own.push({n:e,v:l[e]})}),vm.own.sort(function(e,o){var l=vm.selected.size(),r=l;return vm.selected.forEach(function(n,m){e.n==n.n&&(l=m),o.n==n.n&&(r=m)}),l-r});for(var t in gem)for(var n=0;n<vm.selected.size();n++){var m=vm.selected[n].n;m in gem[t].s&&gem[t].s[m]>0&&gem[t].s[m]<=vm.selected[n].r-l[m]&&vm.gem.push(gem[t])}},reload:function(){vm.popup="before_loading",vm.closable=!0},load:function(){}});vm.$watch("condition",function(e,o){vm.skill=skill.filter(enable)}),vm.$watch("popup",function(e,o){""==o&&(document.documentElement.scrollTop=0,document.body.scrollTop=0)}),require(["domReady!","mmRequest"],function(){if(localStorage.getItem("update")){vm.popup="loading",vm.closable=!1,vm.info="读取本地缓存…";var e=new Promise(function(e,o){armor=JSON.parse(localStorage.getItem("armor")),skill=JSON.parse(localStorage.getItem("skill")),gem=JSON.parse(localStorage.getItem("gem")),e("读取本地缓存…")});e.then(function(){vm.popup=""})}else vm.popup="before_loading",vm.closable=!1;vm.load=function(){vm.popup="loading",vm.closable=!1,vm.info="数据读取中…",avalon.get("all.json").done(function(e){if(0==e.errCode&&"success"==e.msg){armor=[[[],[],[],[],[]],[[],[],[],[],[]]],skill=[],gem=[],vm.selected=[];var o=e.result;for(var l in o){var r=o[l],n=r.iID,m=r.data;if(n>=6e4&&7e4>n&&m[12]>=40){for(var t=""==m[3]?0:1,a=n%5,s=[],i=21;37>i;i+=3)""!=m[i]&&s.push(m[i]+"x"+m[i+1]);for(var v={},i=38;47>i;i+=2)"#N/A"!=m[i]&&(v[m[i]]=parseInt(m[i+1],10));r={n:m[1],h:m[5],m:s.join("，"),s:v,o:!1},armor[t][a].push(r)}else if(n>=1e6&&2e6>n)"无"!=m[3]&&(skillEffect[m[3]]=10);else if(n>=2e6&&3e6>n)skillEffect[m[2]]=0==m[7]?7:parseInt(100/m[7],10);else if(n>=5e6&&6e6>n){var s=[m[13]+"x"+m[14],m[15]+"x"+m[16]];""!=m[17]&&s.push(m[17]+"x"+m[18]);var v={};v[m[5]]=parseInt(m[6],10),""!=m[8]&&(v[m[8]]=parseInt(m[9],10)),r={n:m[2],h:m[3],m:s.join("，"),s:v,o:!1},gem.push(r)}}Object.keys(skillEffect).forEach(function(e){skill.push({n:e,v:skillEffect[e]})}),localStorage.setItem("armor",JSON.stringify(armor)),localStorage.setItem("skill",JSON.stringify(skill)),localStorage.setItem("gem",JSON.stringify(gem)),localStorage.setItem("update",new Date),vm.popup=""}else vm.info="数据读取失败…请稍后再试"}).fail(function(){vm.info="数据读取失败…请稍后再试"})}});