function initSkill(e){for(var o={},r=0;r<e.size();r++)o[e[r].n]=0;return o}avalon.config({baseUrl:"lib"});var armor=[[[],[],[],[],[]],[[],[],[],[],[]]],gem=[],vm=avalon.define({$id:"mho",popup:"",skill:[],selected:[],chosen:[],$computed:{ranged:{set:function(e){localStorage.setItem("ranged",e)},get:function(){return localStorage.getItem("ranged")?eval(localStorage.getItem("ranged")):!1}}},hidePopup:function(){vm.popup=""},listSkill:function(){vm.popup="skill_choose"},addSkill:function(e,o,r){vm.selected.push({n:e,v:o,r:10}),vm.skill.splice(r,1)},skillMinus:function(e){e.r--},skillPlus:function(e){e.r++},removeSkill:function(e){vm.skill.push(vm.selected[e]),vm.selected.splice(e,1)},skillJoin:function(e){var o=[];for(var r in e)o.push(r+e[r]);return o.join("，")},calc:function(){var e=initSkill(vm.selected),o=vm.ranged?1:0,r={};do{r=initSkill(vm.selected),vm.chosen=[];for(var l=0;5>l;l++){var t=0,n=-1;for(var s in armor[o][l]){for(var a=15*armor[o][l][s].h,i=0;i<vm.selected.size();i++){var m=vm.selected[i].n;m in armor[o][l][s].s&&(a+=(vm.selected[i].v-e[m])*armor[o][l][s].s[m])}a>t&&(t=a,n=s)}t>0&&vm.chosen.push(armor[o][l][n])}for(var c=0,v=0,i=0;i<vm.selected.size();i++){for(var m=vm.selected[i].n,l=0;l<vm.chosen.size();l++)m in vm.chosen[l].s&&(r[m]+=parseInt(vm.chosen[l].s[m],10));r[m]>vm.selected[i].r?(e[m]++,c++):r[m]<vm.selected[i].r&&v++}}while(c>0&&v>0);console.log(r)},reload:function(){}});require(["domReady!","mmRouter","mmRequest"],function(){function e(e){return new Promise(function(o,r){e&&localStorage.getItem("update")?(armor=JSON.parse(localStorage.getItem("armor")),vm.skill=JSON.parse(localStorage.getItem("skill")),gem=JSON.parse(localStorage.getItem("gem")),o("读取本地缓存…")):avalon.get("all.json").done(function(e){if(0==e.errCode&&"success"==e.msg){armor=[[[],[],[],[],[]],[[],[],[],[],[]]],vm.skill=[],gem=[],vm.selected=[];var l=e.result;for(var t in l){var n=l[t],s=n.iID,a=n.data;if(s>=6e4&&7e4>s&&a[12]>=40){for(var i=""==a[3]?0:1,m=s%5,c=[],v=21;37>v;v+=3)""!=a[v]&&c.push(a[v]+"x"+a[v+1]);for(var u={},v=38;47>v;v+=2)"#N/A"!=a[v]&&(u[a[v]]=a[v+1]);n={n:a[1],h:a[5],m:c.join("，"),s:u},armor[i][m].push(n)}else if(s>=2e6&&3e6>s)vm.skill.push({n:a[2],v:0==a[7]?7:parseInt(100/a[7],10)});else if(s>=5e6&&6e6>s){var c=[a[13]+"x"+a[14],a[15]+"x"+a[16]];""!=a[17]&&c.push(a[17]+"x"+a[18]);var u={};u[a[5]]=a[6],""!=a[8]&&(u[a[8]]=a[9]),n={n:a[2],h:a[3],m:c.join("，"),s:u},gem.push(n)}}localStorage.setItem("armor",JSON.stringify(armor)),localStorage.setItem("skill",JSON.stringify(vm.skill)),localStorage.setItem("gem",JSON.stringify(gem)),localStorage.setItem("update",new Date),o("数据读取成功…")}else r("数据读取失败…")}).fail(function(){r("数据读取失败…")})})}e(!0).then(function(e){console.log(e)}),vm.reload=function(){e(!1).then(function(e){console.log(e)})},avalon.history.start({})});