function initSkill(e){for(var o={},r=0;r<e.size();r++)o[e[r].n]=0;return o}function enable(e){var o=!0;return vm.selected.forEach(function(r){e.n==r.n&&(o=!1)}),""!=vm.condition&&e.n.indexOf(vm.condition)<0&&(o=!1),o}avalon.config({baseUrl:"lib",debug:!1});var armor=[[[],[],[],[],[]],[[],[],[],[],[]]],gem=[],skillEffect={},skill=[],holeValue=[0,14,36,75],vm=avalon.define({$id:"mho",popup:"",closable:!0,skill:[],selected:[],armor:[],gem:[],own:[],info:"",condition:"",$computed:{ranged:{set:function(e){localStorage.setItem("ranged",e)},get:function(){return localStorage.getItem("ranged")?eval(localStorage.getItem("ranged")):!1}}},hidePopup:function(e){vm.closable&&"div"==e.target.nodeName.toLowerCase()&&(vm.popup="")},listSkill:function(){vm.skill=skill.filter(enable),vm.closable=!0,vm.popup="skill_choose"},addSkill:function(e,o,r){vm.selected.push({n:e,v:o,r:10}),vm.condition="",vm.popup=""},skillMinus:function(e){e.r--},skillPlus:function(e){e.r++},skillJoin:function(e){var o=[];for(var r in e)o.push(r+e[r]);return o.join("，")},showChosen:function(e){e.o=!e.o},calc:function(){var e=initSkill(vm.selected),o=vm.ranged?1:0,r={};vm.gem=[];do{r=initSkill(vm.selected),vm.armor=[];for(var l=0;5>l;l++){var n=0,a=-1;for(var i in armor[o][l]){for(var t=holeValue[armor[o][l][i].h],m=0;m<vm.selected.size();m++){var s=vm.selected[m].n;s in armor[o][l][i].s&&(t+=(vm.selected[m].v-e[s])*armor[o][l][i].s[s])}t>n&&(n=t,a=i)}n>0&&vm.armor.push(armor[o][l][a])}for(var v=0,c=0,m=0;m<vm.selected.size();m++){for(var s=vm.selected[m].n,l=0;l<vm.armor.size();l++)s in vm.armor[l].s&&(r[s]+=vm.armor[l].s[s]);r[s]>vm.selected[m].r?(e[s]++,v++):r[s]<vm.selected[m].r&&c++}}while(v>0&&c>0);var f=0;r=initSkill(vm.selected),vm.own=[];for(var l=0;l<vm.armor.size();l++){vm.armor[l].h>f&&(f=vm.armor[l].h);for(var m in vm.armor[l].s)m in r?r[m]+=vm.armor[l].s[m]:r[m]=vm.armor[l].s[m]}Object.keys(r).forEach(function(e){vm.own.push({n:e,v:r[e]})}),vm.own.sort(function(e,o){var r=vm.selected.size(),l=r;return vm.selected.forEach(function(n,a){e.n==n.n&&(r=a),o.n==n.n&&(l=a)}),r-l});for(var l in gem)for(var m=0;m<vm.selected.size();m++){var s=vm.selected[m].n;s in gem[l].s&&gem[l].s[s]>0&&gem[l].s[s]<=vm.selected[m].r-r[s]&&vm.gem.push(gem[l])}},reload:function(){vm.popup="before_loading",vm.closable=!0},load:function(){}});vm.$watch("condition",function(e,o){vm.skill=skill.filter(enable)}),require(["domReady!","mmRequest"],function(){if(localStorage.getItem("update")){vm.popup="loading",vm.closable=!1,vm.info="读取本地缓存…";var e=new Promise(function(e,o){armor=JSON.parse(localStorage.getItem("armor")),skill=JSON.parse(localStorage.getItem("skill")),gem=JSON.parse(localStorage.getItem("gem")),e("读取本地缓存…")});e.then(function(){vm.popup=""})}else vm.popup="before_loading",vm.closable=!1;vm.load=function(){vm.popup="loading",vm.closable=!1,vm.info="数据读取中…",avalon.get("all.json").done(function(e){if(0==e.errCode&&"success"==e.msg){armor=[[[],[],[],[],[]],[[],[],[],[],[]]],skill=[],gem=[],vm.selected=[];var o=e.result;for(var r in o){var l=o[r],n=l.iID,a=l.data;if(n>=6e4&&7e4>n&&a[12]>=40){for(var i=""==a[3]?0:1,t=n%5,m=[],s=21;37>s;s+=3)""!=a[s]&&m.push(a[s]+"x"+a[s+1]);for(var v={},s=38;47>s;s+=2)"#N/A"!=a[s]&&(v[a[s]]=parseInt(a[s+1],10));l={n:a[1],h:a[5],m:m.join("，"),s:v,o:!1},armor[i][t].push(l)}else if(n>=1e6&&2e6>n)"无"!=a[3]&&(skillEffect[a[3]]=10);else if(n>=2e6&&3e6>n)skillEffect[a[2]]=0==a[7]?7:parseInt(100/a[7],10);else if(n>=5e6&&6e6>n){var m=[a[13]+"x"+a[14],a[15]+"x"+a[16]];""!=a[17]&&m.push(a[17]+"x"+a[18]);var v={};v[a[5]]=parseInt(a[6],10),""!=a[8]&&(v[a[8]]=parseInt(a[9],10)),l={n:a[2],h:a[3],m:m.join("，"),s:v,o:!1},gem.push(l)}}Object.keys(skillEffect).forEach(function(e){skill.push({n:e,v:skillEffect[e]})}),localStorage.setItem("armor",JSON.stringify(armor)),localStorage.setItem("skill",JSON.stringify(skill)),localStorage.setItem("gem",JSON.stringify(gem)),localStorage.setItem("update",new Date),vm.popup=""}else vm.info="数据读取失败…请稍后再试"}).fail(function(){vm.info="数据读取失败…请稍后再试"})}});