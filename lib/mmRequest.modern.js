define("mmRequest",["avalon","mmPromise"],function(e){function t(){if(window.VBArray){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}return 0}function r(e){var t=eval;if(e=e.trim())if(1===e.indexOf("use strict")){var r=document.createElement("script");r.text=e,w.appendChild(r).parentNode.removeChild(r)}else t(e)}function s(t,r,s){var r;if(!t||"string"!=typeof t)return null;try{r=(new DOMParser).parseFromString(t,"text/xml")}catch(n){r=void 0}return(!r||r.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+t),r}function n(t){t=e.mix({},A,t),t.type=t.type.toUpperCase();var r="string"==typeof t.data?t.data:e.param(t.data);if(t.querystring=r||"",t.url=t.url.replace(m,"").replace(d,location.protocol+"//"),"boolean"!=typeof t.crossDomain){var s=document.createElement("a");try{s.href=t.url;var n="1"[0]?s.href:s.getAttribute("href",4);s.href=n,t.crossDomain=T.protocol+"//"+T.host!=s.protocol+"//"+s.host}catch(o){t.crossDomain=!0}}return t.hasContent=!f.test(t.type),t.hasContent||(r&&(t.url+=(v.test(t.url)?"&":"?")+r),t.cache===!1&&(t.url+=(v.test(t.url)?"&":"?")+"_time="+(new Date-0))),t}function o(t,r,s){var n;if(Array.isArray(r))e.each(r,function(e,r){E.test(t)?s(t,r):o(t+"["+("object"==typeof r?e:"")+"]",r,s)});else if(e.isPlainObject(r))for(n in r)o(t+"["+n+"]",r[n],s);else s(t,r)}function a(e){try{return decodeURIComponent(e)}catch(t){return e}}function i(e,t,r){var s=t.match(b);if(!s)return!0;for(var n,o,i,p=[],u=!0;(o=t.lastIndexOf("%5B"))&&-1!==o;)i=t.slice(o).slice(3,-3),t=t.slice(0,o),""===i?p.unshift({action:"pushArrayElement"}):(i>>>0)+""===i?p.unshift({action:"setSubArray",value:i}):u?p.unshift({action:"setObjectProperty",value:a(i)}):p.unshift({action:"setSubObjet",value:a(i)}),u=!1;for(u=!0;n=p.shift();){var c=/Object/.test(n.action);switch(u&&(t in e||(e[t]=c?{}:[]),u=!1,e=e[t]),n.action){case"pushArrayElement":e.push(r);break;case"setObjectProperty":e[n.value]=r;break;case"setSubObjet":n.value in e||(e[n.value]={}),e=e[n.value];break;case"setSubArray":n.value in e||(e[n.value]=[]),e=e[n.value]}}}function p(e){return e.replace(R,"\r\n")}var u=window,c=u.document,l=(encodeURIComponent,decodeURIComponent,/^(?:about|app|app-storage|.+-extension|file|res|widget):$/),h=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,f=/^(?:GET|HEAD)$/,d=/^\/\//,m=/#.*$/,v=/\?/,y=/(=)\?(?=&|$)|\?\?/,x=/%20/g,j=/\+/g,b=/%5B(.*?)%5D$/,T=document.createElement("a");T.href=location.href;var g={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",script:"text/javascript, application/javascript","*":["*/"]+["*"]};0===t()||t()>8;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.lastIndexOf(e,t)===t});var w=c.head;l.test(location.protocol);e.xhr=function(){return new XMLHttpRequest};var C="withCredentials"in e.xhr(),A={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,jsonp:"callback"},H={setRequestHeader:function(e,t){return this.requestHeaders[e]=t,this},getAllResponseHeaders:function(){return 4===this.readyState?this.responseHeadersString:null},getResponseHeader:function(e,t){if(4===this.readyState){for(;t=h.exec(this.responseHeadersString);)this.responseHeaders[t[1]]=t[2];t=this.responseHeaders[e]}return void 0===t?null:t},overrideMimeType:function(e){return this.mimeType=e,this},abort:function(e){return e=e||"abort",this.transport&&this.respond(0,e),this},dispatch:function(t,r){var s=r;if(this.transport){this.readyState=4;var n=t>=200&&300>t||304===t;if(n)if(204===t)s="nocontent";else if(304===t)s="notmodified";else if("undefined"==typeof this.response){var o=this.options.dataType||this.options.mimeType;(!o&&this.responseText||this.responseXML)&&(o=this.getResponseHeader("Content-Type")||"",o=o.match(/json|xml|script|html/i)||["text"],o=o[0].toLowerCase());var a=this.responseText||"",i=this.responseXML||"";try{this.response=e.ajaxConverters[o].call(this,a,i)}catch(p){n=!1,this.error=p,s="parsererror"}}this.status=t,this.statusText=s+"",this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID),this._transport=this.transport;var u=this;n?(this._resolve([this.response,s,this]),window.setTimeout(function(){e.ajaxGlobalEvents.success(u,u.options,u.response)},0)):(this._reject([this,s,this.error]),window.setTimeout(function(){e.ajaxGlobalEvents.error(u,u.options,s)},0)),delete this.transport,q--,window.setTimeout(function(){e.ajaxGlobalEvents.complete(u,u.options)},0),0===q&&window.setTimeout(function(){e.ajaxGlobalEvents.stop()},0)}}},q=0;e.ajax=function(t,r){t&&t.url||e.error("参数必须为Object并且拥有url属性"),t=n(t);var s,o,a={responseHeadersString:"",responseHeaders:{},requestHeaders:{},querystring:t.querystring,readyState:0,uniqueID:(""+Math.random()).replace(/0\./,""),status:0},r=new e.Promise(function(e,t){o=e,s=t});r.options=t,r._reject=s,r._resolve=o;var i=[],p=[];Array("done","fail","always").forEach(function(e){r[e]=function(t){return"function"==typeof t&&("fail"!==e&&i.push(t),"done"!==e&&p.push(t)),this}});var u=t.async===!1;u&&(e.log("warnning:与jquery1.8一样,async:false这配置已经被废弃"),r.async=!1),e.mix(r,a,H),r.then(function(e){e=Array.isArray(e)?e:void 0===e?[]:[e];for(var t,s=0;t=i[s++];)t.apply(r,e);return e},function(e){e=Array.isArray(e)?e:void 0===e?[]:[e];for(var t,s=0;t=p[s++];)t.apply(r,e);return e}),r.done(t.success).fail(t.error).always(t.complete);var c=t.dataType,l=e.ajaxTransports;(t.crossDomain&&!C||y.test(t.url))&&"json"===c&&"GET"===t.type&&(c=t.dataType="jsonp");var h=t.form?"upload":c,f=l[h]||l.xhr;e.mix(r,f),r.preproccess&&(c=r.preproccess()||c),t.contentType&&r.setRequestHeader("Content-Type",t.contentType),r.setRequestHeader("Accept",g[c]?g[c]+", */*; q=0.01":g["*"]);for(var d in t.headers)r.setRequestHeader(d,t.headers[d]);return t.async&&t.timeout>0&&(r.timeoutID=setTimeout(function(){r.abort("timeout"),r.dispatch(0,"timeout")},t.timeout)),0===q&&e.ajaxGlobalEvents.start(),e.ajaxGlobalEvents.send(r,t),q++,r.request(),r},"get,post".replace(e.rword,function(t){e[t]=function(r,s,n,o){return"function"==typeof s&&(o=o||n,n=s,s=void 0),e.ajax({type:t,url:r,data:s,success:n,dataType:o})}}),e.getScript=function(t,r){return e.get(t,null,r,"script")},e.getJSON=function(t,r,s){return e.get(t,r,s,"json")},e.upload=function(t,r,s,n,o){return"function"==typeof s&&(o=n,n=s,s=void 0),e.ajax({url:t,type:"post",dataType:o,form:r,data:s,success:n})},e.ajaxGlobalEvents={},["start","stop","complete","error","success","send"].forEach(function(t){e.ajaxGlobalEvents[t]=e.noop}),e.ajaxConverters={text:function(e){return e},xml:function(e,t){return void 0!==t?t:s(e)},html:function(t){return e.parseHTML(t)},json:function(t){return e.parseJSON||e.log("avalon.parseJSON不存在,请升级到最新版"),e.parseJSON(t)},script:function(e){return r(e),e},jsonp:function(){var t,r;return this.jsonpCallback.startsWith("avalon.")?(r=this.jsonpCallback.replace(/avalon\./,""),t=e[r],delete e[r]):t=window[this.jsonpCallback],t}};var E=/\[\]$/;e.param=function(t){var r,s=[],n=function(e,t){t="function"==typeof t?t():null==t?"":t,s[s.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(Array.isArray(t))e.each(t,n);else for(r in t)o(r,t[r],n);return s.join("&").replace(x,"+")},e.unparam=function(e,t,r){t=t||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;-1!==e.indexOf("?")&&(e=e.split("?").pop());for(var n,o=e.split(t),p=0;n=o[p++];){var u=n.split("=");if(1===u.length)s[u[0]]="";else{var c=u[0].replace(j,"%20"),l=a(u.slice(1).join("=").replace(j," "));if(i(s,c,l)){var h=a(c);Object.prototype.hasOwnProperty.call(s,h)?Array.isArray(s[h])?s[h].push(l):s[h]=[s[h],l]:s[h]=l}}}return s};var S=/select|input|button|textarea/i,D=/radio|checkbox/,R=/\r?\n/g;e.serialize=function(t){var r={};return Array.prototype.filter.call(t.getElementsByTagName("*"),function(e){return S.test(e.nodeName)&&e.name&&!e.disabled?D.test(e.type)?e.checked:!0:void 0}).forEach(function(t){var s=e(t).val();s=Array.isArray(s)?s.map(p):p(s);var n=t.name;n in r?Array.isArray(s)?r[n].push(s):r[n]=[r[n],s]:r[n]=s}),e.param(r,!1)};var I={0:200,1223:204},O=e.ajaxTransports={xhr:{request:function(){var t=this,r=this.options,s=this.transport=new e.xhr;s.open(r.type,r.url,r.async,r.username,r.password),this.mimeType&&s.overrideMimeType&&s.overrideMimeType(this.mimeType),s.withCredentials=!0,r.crossDomain||(this.requestHeaders["X-Requested-With"]="XMLHttpRequest");for(var n in this.requestHeaders)s.setRequestHeader(n,this.requestHeaders[n]+"");r.progressCallback&&(s.upload.onprogress=r.progressCallback);var o=r.dataType;"responseType"in s&&/^(blob|arraybuffer|text)$/.test(o)&&(s.responseType=o,this.useResponseType=!0),s.send(r.hasContent&&(this.formdata||this.querystring)||null),s.onload=s.onerror=function(e){this.readyState=4,this.status="load"===e.type?200:500,t.respond()}},respond:function(e,t){var r=this.transport;if(r){t&&this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID);var s=4===r.readyState;if(t||s)if(r.onerror=r.onload=null,t)s||"function"!=typeof r.abort||r.abort();else{var n=r.responseText,o=r.statusText,a=I[a]||r.status;this.useResponseType&&(this.response=r.response),this.responseText="string"==typeof n?n:void 0,this.responseXML=(r.responseXML||{}).documentElement,this.responseHeadersString=r.getAllResponseHeaders(),this.dispatch(a,o)}}}},jsonp:{preproccess:function(){var t=this.options,r=this.jsonpCallback=t.jsonpCallback||"avalon.jsonp"+setTimeout("1");return y.test(t.url)?t.url=t.url.replace(y,"$1"+r):t.url=t.url+(v.test(t.url)?"&":"?")+t.jsonp+"="+r,r.startsWith("avalon.")?(r=r.replace(/avalon\./,""),e[r]=function(t){e[r]=t}):window[r]=function(e){window[r]=e},"script"}},script:{request:function(){var e=this.options,t=this.transport=c.createElement("script");e.charset&&(t.charset=e.charset);var r=this;t.onerror=t.onload=function(){r.respond()},t.src=e.url,w.insertBefore(t,w.firstChild)},respond:function(t,r){var s=this.transport;if(s){r&&this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID),s.onerror=s.onload=null;var n=s.parentNode;if(n&&n.removeChild(s),!r){var o;if(this.jsonpCallback){var a=this.jsonpCallback.startsWith("avalon.")?e[this.jsonpCallback.replace(/avalon\./,"")]:window[this.jsonpCallback];o="function"==typeof a?[500,"error"]:[200,"success"]}else o=[200,"success"];this.dispatch.apply(this,o)}}}},upload:{preproccess:function(){var t,r=this.options;"function"==typeof r.form.append?(t=r.form,r.contentType=""):t=new FormData(r.form),e.each(r.data,function(e,r){t.append(e,r)}),this.formdata=t}}};return e.mix(O.jsonp,O.script),e.mix(O.upload,O.xhr),e});